(function(){angular.module("tecApp",["ngRoute"]);e.$inject=["$routeProvider","$locationProvider"];function e(e,t){e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/history",{templateUrl:"history/history.view.html",controller:"historyCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode({enabled:true,requireBase:false})}angular.module("tecApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("tecApp").controller("homeCtrl",e);e.$inject=["tecData","taxCalculator","authentication"];function e(s,u,c){var g=this;g.pageHeader={title:"Tax Estimation Calculator",strapline:"Use this simple calculator to find out your estimated tax and net from a given income."};s.getTaxRateList().then(function e(t){var r=t.data;if(r.length>0){g.yearSeletorOptions=r;g.formData={year:r[0]}}},function e(t){console.log("Something went wrong when getting taxRates into year selector.")});if(c.isLoggedIn()){var e=c.currentUser();s.getPersonalTaxRecordByEmail().then(function e(t){var r=t.data;if(r){g.personalTaxRecord=r}},function e(t){console.log("Something went wrong when getting personalTaxRecord.")})}g.annualResult={gross:0,net:0,sup:0,netPlusSup:0,grossPlusSup:0,tax:0};g.onSubmit=function(){var e,t,r,n;var o,a,i,l;o=a=i=l=0;g.formError="";try{if(!g.formData.gross){e=0}else{e=parseInt(g.formData.gross);if(!e){throw"Gross field must be a number"}else if(e<0){throw"Gross field must large than zero"}}if(!g.formData.grossPlusSup){t=0}else{t=parseInt(g.formData.grossPlusSup);if(!t){throw"Gross + sup field must be a number"}else if(t<0){throw"Gross + sup field must large than zero"}}if(!g.formData.supRate){r=0}else{r=parseFloat(g.formData.supRate);if(!r){throw"Sup rate field must be a number"}else if(r<0||r>100){throw"Sup rate must between 0 to 100"}}if(!(n=g.formData.year)){throw"Tax rate field is empty"}if(g.formData.gross&&g.formData.grossPlusSup&&e>t){throw"Gross field should less than gross + sup field"}e=u.getGross(e,t,r);a=u.getSup(e,t,r);t=u.getGrossPlusSup(t,e,a);i=u.getTax(e,n);o=u.getNet(e,i);l=u.getNetPlusSup(o,a);g.annualResult={gross:e,net:o,sup:a,netPlusSup:l,grossPlusSup:t,tax:i};if(c.isLoggedIn()){s.postTaxResult(g.personalTaxRecord._id,g.annualResult).then(function e(t){console.log("Save succeed: "+t.data)},function e(t){console.log("Something went wrong when getting personalTaxRecord.")})}}catch(e){g.formError=e}}}})();(function(){angular.module("tecApp").controller("historyCtrl",e);function a(e,t){var r=[];for(var n=0,o=-1;n<e.length;n++){var a=n%t;if(a==0){r[++o]=[]}r[o][a]=e[n]}return r}e.$inject=["tecData","authentication","$location"];function e(e,t,r){if(t.isLoggedIn()){var o=this;e.getPersonalTaxRecordByEmail("test@gmail.com").then(function e(t){var r=t.data;if(r){o.personalTaxRecord=r;o.historyMatrix=a(o.personalTaxRecord.taxResults,2)}},function e(t){console.log("Something went wrong when getting personalTaxRecord.")});o.deleteRecord=function(n){e.deleteTaxResult(o.personalTaxRecord._id,n).then(function e(t){console.log("Delete succeed");var r=o.personalTaxRecord.taxResults.map(function(e){return e._id}).indexOf(n);if(r>-1){o.personalTaxRecord.taxResults.splice(r,1);o.historyMatrix=a(o.personalTaxRecord.taxResults,2)}},function e(t){console.log("Something went wrong when deleting taxResult.")})}}else{r.path("/")}}})();(function(){angular.module("tecApp").controller("registerCtrl",e);e.$inject=["$location","authentication","tecData"];function e(n,o,a){var i=this;i.title="Create a new TEC account";i.credentials={name:"",email:"",password:""};i.returnPage=n.search().page||"/";i.onSubmit=function(){i.formError="";if(!i.credentials.name||!i.credentials.email||!i.credentials.password){i.formError="All fields required, please try again";return false}else{var e=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(e.test(String(i.credentials.email).toLowerCase())){i.doRegister()}else{i.formError="Email field is invalid";return false}}};i.doRegister=function(){i.formError="";o.register(i.credentials).then(function e(t){var r=o.currentUser();a.createPersonalTaxRecord(r.email).then(function e(t){console.log("Create personal tax record succeed: ",t.data)},function e(t){console.log("Something went wrong when creating personal tax record.")});n.search("page",null);n.path(i.returnPage)},function e(t){i.formError=t.data.errmsg})}}})();(function(){angular.module("tecApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(r,e){var n=this;n.title="Sign in to TEC";n.credentials={email:"",password:""};n.returnPage=r.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.doLogin()}};n.doLogin=function(){n.formError="";e.login(n.credentials).then(function e(t){r.search("page",null);r.path(n.returnPage)},function e(t){n.formError=t.data.message})}}})();(function(){angular.module("tecApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var r=this;r.currentPath=e.path();r.isLoggedIn=t.isLoggedIn();r.currentUser=t.currentUser();r.logout=function(){t.logout();r.isLoggedIn=t.isLoggedIn();e.path("/")}}})();(function(){angular.module("tecApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("tecApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("tecApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("tecApp").service("tecData",e);e.$inject=["$http","authentication"];function e(r,n){var e=function(){return r.get("/api/taxRates")};var t=function(e){return r.post("/api/personalTaxRecords?email="+e)};var o=function(){return r.get("/api/personalTaxRecords",{headers:{Authorization:"Bearer "+n.getToken()}})};var a=function(e,t){return r.post("/api/personalTaxRecords/"+e+"/taxResults",t,{headers:{Authorization:"Bearer "+n.getToken()}})};var i=function(e,t){return r.delete("/api/personalTaxRecords/"+e+"/taxResults/"+t,{headers:{Authorization:"Bearer "+n.getToken()}})};return{getTaxRateList:e,createPersonalTaxRecord:t,getPersonalTaxRecordByEmail:o,postTaxResult:a,deleteTaxResult:i}}})();(function(){angular.module("tecApp").service("taxCalculator",e);function e(){var e=function(e,t){return e-t};var o=function(e,t,r){var n=0;if(e&&r){n=e*r/100}else if(e&&t){n=t-e}else if(t&&r){n=t*r/(100+r)}return n};var t=function(e,t){return e+t};var r=function(e,t,r){var n;if(e){n=e}else if(t&&r){n=t-o(e,t,r)}else{n=0}return n};var n=function(e,t,r){var n;if(e){n=e}else{n=t+r}return n};var a=function(e,t){var r=null;var n=t.taxRanges;for(var o=0;o<n.length;o++){if(e<n[o].to||n[o].to==-1){r=n[o];break}}return(e-r.over)*r.percentage/100+r.amount};return{getNet:e,getSup:o,getNetPlusSup:t,getGross:r,getGrossPlusSup:n,getTax:a}}})();(function(){angular.module("tecApp").service("authentication",e);e.$inject=["$window","$http"];function e(r,t){var n=function(e){r.localStorage["etc-token"]=e};var o=function(){return r.localStorage["etc-token"]};var e=function(e){return t.post("/api/register",e).then(function(e){n(e.data.token)})};var a=function(e){return t.post("/api/login",e).then(function(e){n(e.data.token)})};var i=function(){r.localStorage.removeItem("etc-token")};var l=function(){var e=o();if(e){var t=JSON.parse(r.atob(e.split(".")[1]));return t.exp>Date.now()/1e3}else{return false}};var s=function(){if(l()){var e=o();var t=JSON.parse(r.atob(e.split(".")[1]));return{email:t.email,name:t.name}}};return{saveToken:n,getToken:o,register:e,login:a,logout:i,isLoggedIn:l,currentUser:s}}})();(function(){angular.module("tecApp").filter("formatFloat",e);function e(){return function(e,t){return e.toFixed(t)}}})();